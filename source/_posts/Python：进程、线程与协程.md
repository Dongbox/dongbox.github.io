---
title: Python：进程、线程与协程
date: 2022-12-10 10:54:10
tags: Python
categories: Python面试题
cover: https://images.unsplash.com/photo-1667423520863-8653106f18e7
---

### 基本概念

#### 进程(Process)

进程是应用程序的启动实例，进程拥有代码和打开的文件资源、数据资源、独立的内存空间。

#### 线程(Lightweight Process，LWP)

线程从属于进程，是程序的实际执行者，一个进程至少包含一个主线程，也可以有更多的子线程，线程拥有自己的栈空间。
对操作系统而言，线程是最小的执行单元，进程是最小的资源管理单元。无论是进程还是线程，都是由操作系统所管理的。

#### 协程(Coroutines)

协程是一种比线程更加轻量级的存在，正如一个进程可以拥有多个线程一样，一个线程可以拥有多个协程。协程不是被操作系统内核所管理的，而是完全由程序所控制，也就是在用户态执行。这样带来的好处是性能大幅度的提升，因为不会像线程切换那样消耗资源。

协程本质上就是一个线程，不过它是协作式的非抢占式的程序，面向的是IO操作。python有GIL的限制，不能充分利用多线程的实现高并发。进程和线程都是通过cpu的调度实现不同任务的有序执行，协程则要在写代码的时候确定执行顺序。由于协程在一个线程中，所以协程不能阻塞。

##### 优缺点：

- 无需线程上下文切换的开销
- 在一个线程中，不需要加锁
- 无法利用多核资源：协程的本质是单线程，需要和进程配合才能运行在多CPU上
- 进行阻塞(Blocking)操作(如IO时)会阻塞掉整个程序

#### python协程的发展时间较长：

- python2.5 为生成器引用.send()、.throw()、.close()方法。
- python3.3 为引入yield from，可以接收返回值，可以使用yield from定义协程。
- Python3.4 加入了asyncio模块。
- Python3.5 增加async、await关键字，在语法层面的提供支持。
- python3.7 使用async def + await的方式定义协程。
- 此后asyncio模块更加完善和稳定，对底层的API进行的封装和扩展。
- python将于 3.10版本中移除 以yield from的方式定义协程 （目前版本是3.9.1）。

#### 进程、线程、协程的对比:

(1)协程既不是进程也不是线程，协程仅仅是一个特殊的函数，协程它进程和进程不是一个维度的。

(2)一个进程可以包含多个线程，一个线程可以包含多个协程。

(3)一个线程内的多个协程虽然可以切换，但是多个协程是串行执行的，只能在一个线程内运行，没法利用CPU多核能力。

(4)协程与进程、线程一样，切换是存在上下文切换问题的。

#### 上下文切换对比：

(1)进程的切换者是操作系统，切换时机是根据操作系统自己的切换策略，用户是无感知的。进程的切换内容包括页全局目录、内核栈、硬件上下文，切换内容保存在内存中。进程切换过程是由“用户态到内核态到用户态”的方式，切换效率低。

(2)线程的切换者是操作系统，切换时机是根据操作系统自己的切换策略，用户是无感知的。线程的切换内容包括内核栈和硬件上下文,线程切换内容保存在内核栈中.线程切换过程是由“用户态到内核态到用户态”，切换效率中等。因为线程的调度是在内核态运行的，而线程中的代码是在用户态运行，因此线程切换会导致用户态与内核态的切换

(4)协程的切换者是用户（编程者或应用程序），切换时机是用户自己的程序所决定的。协程的切换内容是硬件上下文，切换内存保存在用户自己的变量（用户栈或堆）中。协程的切换过程只有用户态，即没有陷入内核态，因此切换效率高。

### 参考文章

- [进程/线程/协程的区别_CoreDump1024的博客-CSDN博客_协程和线程和进程的区别](https://blog.csdn.net/m0_47265341/article/details/126914736)

- [浅析Python的进程、线程与协程 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/445467379)

- https://www.cnblogs.com/lczmx/p/14364580.html
