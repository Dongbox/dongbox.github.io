---
title: 'Python：进程和线程'
date: 2022-12-17 10:26:37
tags: Python面试题
categories: Python
cover: https://images.unsplash.com/photo-1671154453575-b0cea38bb19a
---

> 进程——资源分配的最小单位，线程——程序执行的最小单位

 

### 简介

- **进程（Process）** 
  
  进程的目的就是担当分配系统资源（CPU时间、内存等）的基本单位。

- **线程（thread）** 
  
  线程是进程的一个**执行流，是CPU调度和分派的基本单位，它是比进程更小的能独立运行的基本单位。**


进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响，而线程只是一个进程中的不同执行路径。线程有自己的堆栈和局部变量，但线程没有单独的地址空间，一个线程死掉就等于整个进程死掉，所以多进程的程序要比多线程的程序健壮，但在进程切换时，耗费资源较大，效率要差一些。但对于一些要求同时进行并且又要共享某些变量的并发操作，只能用线程，不能用进程


#### 进程的状态及转换

进程是动态的，是运行在内存中的程序的执行实例。

进程整个生命周期可以简单划分为三种状态：

**就绪态：**
进程已经具备执行的一切条件，正在等待分配CPU的处理时间。

**执行态：**
该进程正在占用CPU运行。

**等待态：**
进程因不具备某些执行条件而暂时无法继续执行的状态。

**进程的调度进制：**
时间片轮转，上下文切换
多进程不是说一个进程执行完再执行另一个进程，而是交替执行的，一个进程执行一段时间，然后下一个进程在执行一段时间，依次类推，所有进程执行完之后再回到第一个进程初继续执行以此类推


进程控制块就是用于保存一个进程信息的结构体，又称之为PCB。



#### 线程

每个进程都拥有自己的数据段、代码段和堆栈段，这就造成进程在进行创建、切换、撤销操作时，需要较大的系统开销。

​为了减少系统开销，从进程中演化出了线程。

​线程存在于进程中，共享进程的资源。

​线程是进程中的独立控制流，由环境（包括寄存器组和程序计数器）和一系列的执行指令组成。


##### 使用多线程的理由：

- **和进程相比，它是一种非常"节俭"的多任务操作方式。**
  
  我们知道，在Linux系统下，启动一个新的进程必须分配给它独立的地址空间，建立众多的数据表来维护它的代码段、堆栈段和数据段，这是一种"昂贵"的多任务工作方式。而运行于一个进程中的多个线程，它们彼此之间使用相同的地址空间，共享大部分数据，启动一个线程所花费的空间远远小于启动一个进程所花费的空间，而且，线程间彼此切换所需的时间也远远小于进程间切换所需要的时间。据统计，总的说来，一个进程的开销大约是一个线程开销的30倍左右，当然，在具体的系统上，这个数据可能会有较大的区别。

- **线程间方便的通信机制。**
  
  对不同进程来说，它们具有独立的数据空间，要进行数据的传递只能通过通信的方式进行，这种方式不仅费时，而且很不方便。线程则不然，由于同一进程下的线程之间共享数据空间，所以一个线程的数据可以直接为其它线程所用，这不仅快捷，而且方便。当然，数据的共享也带来其他一些问题，有的变量不能同时被两个线程所修改，有的子程序中声明为static的数据更有可能给多线程程序带来灾难性的打击，这些正是编写多线程程序时最需要注意的地方。
  

### 线程和进程的比较

**调度：**

​线程是CPU调度和分派的基本单位。

**拥有资源：**

​进程是系统中程序执行和资源分配的基本单位。

​线程自己一般不拥有资源（除了必不可少的程序计数器，一组寄存器和栈），但它可以去访问其所属进程的资源，如进程代码段，数据段以及系统资源（已打开的文件，I/O设备等）。

**系统开销：**

​同一个进程中的多个线程可共享同一地址空间，因此它们之间的同步和通信的实现也变得比较容易。

​在进程切换时候，涉及到整个当前进程CPU环境的保存以及新被调度运行的进程的CPU环境的设置；而线程切换只需要保存和设置少量寄存器的内容，并不涉及存储器管理方面的操作，从而能更有效地使用系统资源和提高系统的吞吐量。

**并发性：**

​不仅进程间可以并发执行，而且在一个进程中的多个线程之间也可以并发执行。

**总结：**

​一般把线程称之为轻量级的进程。

​一个进程可以创建多个线程，多个线程共享一个进程的资源。

​每一个进程创建的时候系统会给其4G虚拟内存，3G用户空间是私有的，所以进程切换时，用户空间也会切换，所以会增加系统开销，而一个进程中的多个线程共享一个进程的资源，所以线程切换时不用切换这些资源，效率会更高。

​线程的调度机制跟进程是一样的，多个线程来回切换运行。


**使用多线程的目的主要有以下几点：**

- 多任务程序的设计
  
   一个程序可能要处理不同应用，要处理多种任务，如果开发不同的进程来处理，系统开销很大，数据共享，程序结构都不方便，这时可使用多线程编程方法。

- 并发程序设计
  
  ​一个任务可能分成不同的步骤去完成，这些不同的步骤之间可能是松散耦合，可能通过线程的互斥，同步并发完成。这样可以为不同的任务步骤建立线程。

- 网络程序设计
  
  ​为提高网络的利用效率，我们可能使用多线程，对每个连接用一个线程去处理。

- 数据共享
  
  同一个进程中的不同线程共享进程的数据空间，方便不同线程间的数据共享。
  

**线程与进程的区别和联系?线程是否具有相同的堆栈? dll是否有独立的堆栈?**

进程是死的，只是一些资源的集合，真正的程序执行都是线程来完成的，程序启动的时候操作系统就帮你创建了一个主线程。

每个线程有自己的堆栈。

动态链接库DLL中有没有独立的堆栈，这个问题不好回答。因为DLL中的代码是被某些线程所执行，只有线程拥有堆栈，如果DLL中的代码是EXE中的线程所调用，那么这个时候是不是说这个DLL没有自己独立的堆栈？如果DLL中的代码是由DLL自己创建的线程所执行，那么是不是说DLL有独立的堆栈？




### 参考文章

- [进程线程（一）——基础知识，什么是进程？什么是线程？_口袋里のInit的博客-CSDN博客_进程 线程](https://blog.csdn.net/wangguchao/article/details/109002488)

- [进程和线程_南 城的博客-CSDN博客_进程和线程](https://blog.csdn.net/weixin_45590051/article/details/116530748)

- [Python 线程池 ThreadPoolExecutor(二) - Python零基础入门教程 - 猿说编程 - 博客园 (cnblogs.com)](https://www.cnblogs.com/shuopython/p/14944655.html)
